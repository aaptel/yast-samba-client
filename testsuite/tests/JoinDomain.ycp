{

// test for Samba::joinDomain( domain, user, password )
// $Id$
// testedfiles:Samba.ycp PamSettings.ycp

    include "testsuite.ycp";
    
    import "Samba";
    
    // join domain anonymously
    TEST( ``( Samba::joinDomain( "testing", nil, nil ) ), [
        // read map
	$[
            "etc": $[ "nsswitch_conf" : $[
                "passwd" : "compat ldap",
                "group"  : "compat ldap"
            ] ],
        ],
	$[],
	// execute map
	$[
	    "target" : $[ "bash_output" : $[
		"exit" : 0, // success
		"stdout" : "Joined the domain",
		"stderr" : ""
	    ] ]
	],
	
    ], nil );

    // join domain using account
    TEST( ``( Samba::joinDomain( "testing", "root", "password" ) ), [
        // read map
	$[
            "etc": $[ "nsswitch_conf" : $[
                "passwd" : "compat ldap",
                "group"  : "compat ldap"
            ] ],
	    "target" : $[ "tmpdir" : "/tmp/ahoj" ]
        ],
	$[],
	// execute map
	$[
	    "target" : $[ "bash_output" : $[
		"exit" : 0, // success
		"stdout" : "Joined the domain",
		"stderr" : ""
	    ] ]
	],
    ], nil );
    

    // join domain using account unsuccesfully
    TEST( ``( Samba::joinDomain( "testing", "root", "password" ) ), [
        // read map
	$[
            "etc": $[ "nsswitch_conf" : $[
                "passwd" : "compat ldap",
                "group"  : "compat ldap"
            ] ],
	    "target" : $[ "tmpdir" : "/tmp/ahoj" ]
        ],
	$[],
	// execute map
	$[
	    "target" : $[ "bash_output" : $[
		"exit" : 1, // success
		"stdout" : "Unable to join domain",
		"stderr" : ""
	    ] ]
	],
    ], nil );
}
