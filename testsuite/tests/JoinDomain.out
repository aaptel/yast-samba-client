Write	.etc.smb.value.global.workgroup "testing" true
Write	.etc.smb.value.global.security "domain" true
Write	.etc.smb.value.global."encrypt passwords" "yes" true
Read	.etc.nsswitch_conf.passwd "compat ldap"
Write	.etc.nsswitch_conf.passwd "compat ldap" true
Read	.etc.nsswitch_conf.group "compat ldap"
Write	.etc.nsswitch_conf.group "compat ldap" true
Write	.etc.nsswitch_conf nil true
Write	.pam.all.account.pam_unix2 "-call_module=winbind" true
Write	.pam.all.auth.pam_unix2 "-call_module=winbind" true
Execute	.target.bash_output "smbpasswd -s -j testing" $["exit":0, "stderr":"", "stdout":"Joined the domain"]
Return	nil
Write	.etc.smb.value.global.workgroup "testing" true
Write	.etc.smb.value.global.security "domain" true
Write	.etc.smb.value.global."encrypt passwords" "yes" true
Read	.etc.nsswitch_conf.passwd "compat ldap"
Write	.etc.nsswitch_conf.passwd "compat ldap" true
Read	.etc.nsswitch_conf.group "compat ldap"
Write	.etc.nsswitch_conf.group "compat ldap" true
Write	.etc.nsswitch_conf nil true
Write	.pam.all.account.pam_unix2 "-call_module=winbind" true
Write	.pam.all.auth.pam_unix2 "-call_module=winbind" true
Read	.target.tmpdir "/tmp/ahoj"
Write	.target.string "/tmp/ahoj/domain" "password\npassword\n" true
Execute	.target.bash_output "smbpasswd -s -j testing < /tmp/ahoj/domain" $["exit":0, "stderr":"", "stdout":"Joined the domain"]
Return	nil
Write	.etc.smb.value.global.workgroup "testing" true
Write	.etc.smb.value.global.security "domain" true
Write	.etc.smb.value.global."encrypt passwords" "yes" true
Read	.etc.nsswitch_conf.passwd "compat ldap"
Write	.etc.nsswitch_conf.passwd "compat ldap" true
Read	.etc.nsswitch_conf.group "compat ldap"
Write	.etc.nsswitch_conf.group "compat ldap" true
Write	.etc.nsswitch_conf nil true
Write	.pam.all.account.pam_unix2 "-call_module=winbind" true
Write	.pam.all.auth.pam_unix2 "-call_module=winbind" true
Read	.target.tmpdir "/tmp/ahoj"
Write	.target.string "/tmp/ahoj/domain" "password\npassword\n" true
Execute	.target.bash_output "smbpasswd -s -j testing < /tmp/ahoj/domain" $["exit":1, "stderr":"", "stdout":"Unable to join domain"]
Return	Unable to join the domain.
